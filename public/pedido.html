<!DOCTYPE html>
<html lang="pt-BR">
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<title>Finalizar Pedido – Desce Lava</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<main>

<div class="pedido-container">

  <!-- ✅ LOGO AGORA NO LUGAR CERTO -->
  <img src="imagens/BENDITOMAIORAINDA.png" class="logo-pedido" alt="Desce Lava">

  <h1>Finalizar Pedido</h1>
  <p class="subtitulo">Preencha os dados da sua unidade para confirmar o pedido</p>

  <form class="form-pedido" action="/enpostar" method="post" onsubmit="return validarPedido()">

    <div class="campo">
      <label>Nome da Unidade</label>
      <input id="unidade" name="unidade" required>
    </div>

    <div class="campo">
      <label>Responsável</label>
      <input id="responsavel" name="responsavel" required>
    </div>

    <div class="campo">
      <label>Cidade</label>
      <input id="cidade" name="cidade" required>
    </div>

    <div class="campo">
      <label>Telefone / WhatsApp</label>
      <input id="telefone" name="telefone" required>
    </div>

    <div class="campo">
      <label>E-mail da Unidade</label>
      <input id="email" name="email" type="email" required>
    </div>

    <div class="campo">
      <label>Observações do Pedido <strong>(obrigatório)</strong></label>
      <textarea
        id="observacoes"
        name="observacoes"
        rows="4"
        required
        placeholder="Ex: enviar junto com as etiquetas da unidade"
      ></textarea>
    </div>

    <!-- PRODUTOS -->
    <textarea name="produtos" id="lista_produtos" hidden></textarea>

    <button type="submit" class="btn-enviar">
      Confirmar Pedido
    </button>

  </form>

</div>

</main>

<script>
/* ================= PROTEÇÃO LOGIN ================= */
const franqueado = JSON.parse(localStorage.getItem("franqueadoLogado"));

if (!franqueado) {
  alert("Você precisa estar logado para finalizar o pedido.");
  window.location.href = "login.html";
}

/* ================= PRODUTOS ================= */
const pedido = localStorage.getItem("pedido");

if (pedido) {
  document.getElementById("lista_produtos").value = pedido;
} else {
  alert("Nenhum produto no carrinho.");
  window.location.href = "index.html";
}

/* ================= AUTOPREENCHIMENTO ================= */
document.addEventListener("DOMContentLoaded", () => {
  if (!franqueado) return;

  unidade.value = franqueado.unidade || "";
  responsavel.value = franqueado.unidade || "";
  cidade.value = franqueado.cidade || "";
  telefone.value = franqueado.telefone || "";
  email.value = franqueado.email || "";
});

/* ================= VALIDAÇÃO FINAL ================= */
function validarPedido() {
  if (!observacoes.value.trim()) {
    alert("O campo Observações é obrigatório.");
    observacoes.focus();
    return false;
  }
  return true;
}

console.log("Tela de finalização carregada corretamente");
</script>

</body>
</html>
